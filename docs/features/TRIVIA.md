# Trivia System

LLM-powered trivia games with dynamic question generation, multiple categories, and server leaderboards.

## Overview

The trivia system provides interactive quiz games for Discord servers. Questions are generated dynamically by the LLM, ensuring fresh content and supporting any topic users can think of.

## Features

- **Dynamic Question Generation**: Questions generated by LLM, not from a static database
- **20+ Categories**: Science, History, Geography, Sports, Entertainment, Movies, Music, Technology, and more
- **Three Difficulty Levels**: Easy, Medium, Hard with appropriate complexity scaling
- **Real-time Scoring**: Points awarded based on speed and accuracy
- **Streak Bonuses**: Consecutive correct answers earn bonus points
- **Server Leaderboards**: Track top performers over configurable time periods
- **Session Management**: One active session per channel

## Commands

### `/trivia_start`

Start a new trivia session in the current channel.

**Parameters:**
- `category` (optional): Topic for questions (default: "general knowledge")
- `difficulty` (optional): easy, medium, hard (default: medium)
- `questions` (optional): Number of questions 5-20 (default: 10)

**Example:**
```
/trivia_start category:science difficulty:hard questions:15
/trivia_start category:movies
/trivia_start
```

### `/trivia_stop`

End the current trivia session early. Shows final results and leaderboard.

### `/trivia_stats`

View trivia statistics for yourself or another user.

**Parameters:**
- `user` (optional): View another user's stats

**Shows:**
- Total questions answered
- Correct answers and accuracy percentage
- Total points earned
- Server rank
- Session wins

### `/trivia_leaderboard`

View the server's trivia leaderboard.

**Parameters:**
- `days` (optional): Time period for stats (default: 30)

## Gameplay

### Starting a Game

1. Use `/trivia_start` to begin a session
2. Bot generates questions based on your parameters
3. First question is posted automatically

### Answering Questions

1. Questions display with a 30-second timer
2. Type your answer in the channel
3. Multiple valid answer formats accepted (e.g., "Einstein" or "Albert Einstein")
4. First correct answer wins the most points
5. Later correct answers earn fewer points

### Scoring System

| Factor | Points |
|--------|--------|
| Correct answer (first) | 100 |
| Correct answer (2nd-5th) | 75 |
| Correct answer (later) | 50 |
| Speed bonus (under 5s) | +25 |
| Streak bonus (3+) | +10 per streak |
| Difficulty multiplier (hard) | 1.5x |

### Session End

- Session ends after all questions or when stopped
- Final leaderboard shows all participants
- Stats are saved to database for leaderboard tracking
- Winner announced with celebration

## Technical Details

### Question Generation

Questions are generated via LLM with the following prompt structure:
- Topic/category constraint
- Difficulty calibration
- Multiple acceptable answers for flexibility
- Fact verification to avoid incorrect questions

### Answer Validation

- Case-insensitive matching
- Fuzzy matching for typos (80% similarity threshold)
- Multiple alternative answers accepted
- Number format flexibility (e.g., "1969" or "nineteen sixty-nine")

### Database Tables

- `trivia_sessions`: Active and completed sessions
- `trivia_questions`: Generated questions per session
- `trivia_answers`: Individual answer attempts
- `trivia_stats`: Aggregated user statistics per server

### Rate Limiting

- One active session per channel
- 5-minute cooldown between sessions in same channel
- Question generation limited to prevent abuse

## Cost

- **Question Generation**: ~$0.01-0.02 per 10 questions
- **Zero cost**: Answer validation, scoring, leaderboards

## Example Session

```
User: /trivia_start category:space difficulty:medium questions:5

Bot: üé≤ Starting Trivia Session!
     Topic: Space
     Difficulty: Medium
     Questions: 5

Bot: Question 1/5
     What planet in our solar system has the most moons?
     ‚è±Ô∏è 30 seconds to answer!

User1: jupiter
Bot: ‚úÖ User1 got it! +100 points (5.2s)
     The answer was: Jupiter (with 95 confirmed moons)

User2: saturn
Bot: Close, but Jupiter has more! Saturn has 146 moons.

Bot: Question 2/5
     ...

[After final question]

Bot: üèÜ Trivia Complete!

     Final Standings:
     ü•á User1 - 425 points
     ü•à User3 - 310 points
     ü•â User2 - 275 points
```

## Configuration

No additional configuration required. The trivia system uses the existing LLM configuration for question generation.

## Related Features

- [Chat Statistics](CHAT_STATISTICS.md) - Track overall server engagement
- [Debate Scorekeeper](DEBATE.md) - Another competitive feature
- [Hot Takes](HOT_TAKES.md) - Track controversial predictions
